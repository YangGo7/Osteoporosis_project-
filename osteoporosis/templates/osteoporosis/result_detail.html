{% extends "base.html" %}
{% block explain_contents %}

<div class="container mt-4">
    <h2 class="mb-4">ê³¨ë‹¤ê³µì¦ ì˜ˆì¸¡ ê²°ê³¼</h2>

    <div class="card p-3">
        <h4>í™˜ì ì •ë³´</h4>
        <p><strong>ì´ë¦„:</strong> {{ result.name }}</p>
        <p><strong>ì˜ˆì¸¡ ë‚ ì§œ:</strong> {{ result.created_at|date:"Y-m-d H:i" }}</p>
    </div>

    <div class="card mt-3 p-3">
        <h4>ì˜ˆì¸¡ ê²°ê³¼</h4>
        <p><strong>ì£¼ìš” ê³¨ì ˆ ìœ„í—˜ë„:</strong> {{ result.major_risk }}%</p>
        <p><strong>ê³ ê´€ì ˆ ê³¨ì ˆ ìœ„í—˜ë„:</strong> {{ result.hip_risk }}%</p>
        <p><strong>ìœ„í—˜ ìˆ˜ì¤€:</strong> 
            <span style="color: {% if result.level == 'High Risk' %}red{% elif result.level == 'Caution' %}orange{% else %}green{% endif %}; font-weight: bold;">
                {{ result.level }}
            </span>
        </p>
    </div>

    <div class="mt-4">
        <a href="{% url 'osteoporosis:pdf_my' %}?name={{ result.name }}&major_risk={{ result.major_risk }}&hip_risk={{ result.hip_risk }}&osteoporosis_risk=0&risk_level={{ result.level }}" class="btn btn-primary" target="_blank">
            PDFë¡œ ì €ì¥
        </a>
    </div>

    <!-- âœ… ê·¸ë˜í”„ ì˜ì—­ -->
    <div class="mt-5">
        <h4 class="text-center">ğŸ“Š ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”</h4>
        <canvas id="barChart" class="my-4"></canvas>
        <canvas id="doughnutChart" class="my-4"></canvas>
    </div>
</div>

<!-- âœ… Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const majorRisk = {{ result.major_risk }};
    const hipRisk = {{ result.hip_risk }};

    // âœ… ë§‰ëŒ€ ê·¸ë˜í”„
    const barCtx = document.getElementById('barChart').getContext('2d');
    new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: ['Major Fracture', 'Hip Fracture'],
            datasets: [{
                label: 'ìœ„í—˜ë„ (%)',
                data: [majorRisk, hipRisk],
                backgroundColor: ['#4e79a7', '#f28e2b'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });


</script>

{% endblock explain_contents %}
